<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Juros Compostos Avançada</title>
    
    <!-- Tailwind CSS para um design rápido e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js para o gráfico de evolução -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos personalizados e para os toggles */
        body {
            font-family: 'Poppins', sans-serif;
        }
        .toggle-label {
            width: 100px; /* Largura fixa para alinhar */
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2563eb; /* Azul do Tailwind */
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-4xl bg-white shadow-2xl rounded-2xl overflow-hidden">
        <div class="grid grid-cols-1">
            
            <!-- Coluna da Esquerda: Entradas -->
            <div class="p-8 bg-gray-50">
                <h1 class="text-3xl font-bold text-gray-700 mb-6">Simulador de Investimentos</h1>
                <form id="calculator-form" class="space-y-5">
                    
                    <div>
                        <label for="initialValue" class="block text-sm font-medium text-gray-600">Valor Inicial (R$)</label>
                        <input type="number" id="initialValue" value="1000" class="mt-1 block w-full px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>

                    <div>
                        <label for="monthlyValue" class="block text-sm font-medium text-gray-600">Aporte Mensal (R$)</label>
                        <input type="number" id="monthlyValue" value="300" class="mt-1 block w-full px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    
                    <div>
                        <label for="annualIncrease" class="block text-sm font-medium text-gray-600">Reajuste Anual do Aporte (%)</label>
                        <input type="number" id="annualIncrease" value="5" class="mt-1 block w-full px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>

                    <div class="flex items-center justify-between">
                         <label for="interestRate" class="text-sm font-medium text-gray-600">Taxa de Juros (%)</label>
                         <div class="flex items-center gap-3">
                            <span id="rate-type-label" class="text-sm font-medium text-blue-600">Anual</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="rate-type-toggle">
                                <span class="slider"></span>
                            </label>
                         </div>
                    </div>
                    <input type="number" id="interestRate" value="10" class="block w-full px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    
                    <div class="flex items-center justify-between">
                        <label for="period" class="text-sm font-medium text-gray-600">Período</label>
                         <div class="flex items-center gap-3">
                            <span id="period-type-label" class="text-sm font-medium text-blue-600">Anos</span>
                             <label class="toggle-switch">
                                <input type="checkbox" id="period-type-toggle">
                                <span class="slider"></span>
                            </label>
                         </div>
                    </div>
                     <input type="number" id="period" value="10" class="block w-full px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-lg">
                        Calcular
                    </button>
                </form>
            </div>

            <!-- Coluna da Direita: Resultados -->
            <div id="results-section" class="p-8 bg-white hidden border-t border-gray-200">
                <h2 class="text-2xl font-bold text-gray-700 mb-6">Resultados da Simulação</h2>
                
                <!-- Cards de Resumo -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8 text-center">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-blue-800">Valor Final Bruto</p>
                        <p id="final-value" class="text-xl md:text-2xl font-bold text-blue-900 break-words"></p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-sm text-green-800">Total Investido</p>
                        <p id="total-invested" class="text-xl md:text-2xl font-bold text-green-900 break-words"></p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <p class="text-sm text-yellow-800">Total em Juros</p>
                        <p id="total-interest" class="text-xl md:text-2xl font-bold text-yellow-900 break-words"></p>
                    </div>
                </div>

                <!-- Gráfico -->
                <div class="mb-8 relative">
                    <h3 class="text-lg font-semibold text-gray-600 mb-2">Evolução do Patrimônio</h3>
                    <canvas id="evolutionChart"></canvas>
                </div>

                <!-- Tabela Detalhada -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-600 mb-2">Resumo Anual</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Ano</th>
                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Investido no Ano</th>
                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Juros no Ano</th>
                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Saldo Final</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body">
                                <!-- Linhas da tabela serão inseridas via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
             <!-- Seção de placeholder antes do cálculo -->
            <div id="placeholder-section" class="p-8 flex flex-col items-center justify-center bg-white text-center border-t border-gray-200">
                <svg class="w-24 h-24 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                <h2 class="text-xl font-semibold text-gray-500">Seus resultados aparecerão aqui</h2>
                <p class="text-gray-400 mt-2">Preencha os dados e clique em "Calcular" para iniciar a simulação.</p>
            </div>
        </div>
    </main>

    <script>
        const form = document.getElementById('calculator-form');
        const resultsSection = document.getElementById('results-section');
        const placeholderSection = document.getElementById('placeholder-section');
        const rateTypeToggle = document.getElementById('rate-type-toggle');
        const periodTypeToggle = document.getElementById('period-type-toggle');
        const rateTypeLabel = document.getElementById('rate-type-label');
        const periodTypeLabel = document.getElementById('period-type-label');
        let evolutionChartInstance;

        // --- Event Listeners for Toggles ---
        rateTypeToggle.addEventListener('change', () => {
            rateTypeLabel.textContent = rateTypeToggle.checked ? 'Mensal' : 'Anual';
        });

        periodTypeToggle.addEventListener('change', () => {
            periodTypeLabel.textContent = periodTypeToggle.checked ? 'Meses' : 'Anos';
        });
        
        // --- Form Submission Handler ---
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            placeholderSection.classList.add('hidden');

            // --- Obter Valores do Formulário ---
            const initialValue = parseFloat(document.getElementById('initialValue').value) || 0;
            const monthlyValue = parseFloat(document.getElementById('monthlyValue').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const period = parseInt(document.getElementById('period').value) || 0;
            const annualIncrease = parseFloat(document.getElementById('annualIncrease').value) || 0;
            
            const isRateMonthly = rateTypeToggle.checked;
            const isPeriodInMonths = periodTypeToggle.checked;
            
            // --- Conversões ---
            const monthlyInterestRate = isRateMonthly ? interestRate / 100 : Math.pow(1 + (interestRate / 100), 1/12) - 1;
            const totalMonths = isPeriodInMonths ? period : period * 12;

            // --- Cálculos ---
            let totalAccumulated = initialValue;
            let totalInvested = initialValue;
            let currentMonthlyContribution = monthlyValue;
            
            const chartLabels = [];
            const chartDataInterest = [];
            const chartDataInvested = [];
            const tableData = [];
            
            let lastYearTotalInvested = initialValue;
            let lastYearTotalAccumulated = initialValue;
            
            for (let month = 1; month <= totalMonths; month++) {
                // Adiciona juros
                totalAccumulated *= (1 + monthlyInterestRate);

                // Adiciona aporte mensal
                totalAccumulated += currentMonthlyContribution;
                totalInvested += currentMonthlyContribution;

                // Reajuste anual do aporte
                if (month % 12 === 0 && month < totalMonths) {
                    currentMonthlyContribution *= (1 + annualIncrease / 100);
                }
                
                // Coleta dados para o gráfico e tabela no final de cada ano
                if (month % 12 === 0 || month === totalMonths) {
                    const currentYear = Math.ceil(month/12);
                    const totalInterestSoFar = totalAccumulated - totalInvested;

                    chartLabels.push(`Ano ${currentYear}`);
                    chartDataInterest.push(totalInterestSoFar.toFixed(2));
                    chartDataInvested.push(totalInvested.toFixed(2));
                    
                    const investedInYear = totalInvested - lastYearTotalInvested;
                    const interestInYear = totalAccumulated - lastYearTotalAccumulated - investedInYear;

                    tableData.push({
                        year: currentYear,
                        invested: investedInYear,
                        interest: interestInYear,
                        finalBalance: totalAccumulated
                    });

                    lastYearTotalInvested = totalInvested;
                    lastYearTotalAccumulated = totalAccumulated;
                }
            }
            
            const totalInterest = totalAccumulated - totalInvested;
            
            // --- Exibir Resultados ---
            displayResults(totalAccumulated, totalInvested, totalInterest);
            updateChart(chartLabels, chartDataInterest, chartDataInvested);
            updateTable(tableData);
            
            resultsSection.classList.remove('hidden');
        });

        // --- Funções Auxiliares ---
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function displayResults(totalAccumulatedValue, totalInvestedValue, totalInterestValue) {
            document.getElementById('final-value').textContent = formatCurrency(totalAccumulatedValue);
            document.getElementById('total-invested').textContent = formatCurrency(totalInvestedValue);
            document.getElementById('total-interest').textContent = formatCurrency(totalInterestValue);
        }

        function updateChart(labels, interestData, investedData) {
            const ctx = document.getElementById('evolutionChart').getContext('2d');
            
            if (evolutionChartInstance) {
                evolutionChartInstance.destroy();
            }

            evolutionChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total em Juros',
                        data: interestData,
                        borderColor: '#ef4444', // Vermelho
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'Total Investido',
                        data: investedData,
                        borderColor: '#4b5563', // Cinza Escuro
                        backgroundColor: 'rgba(75, 85, 99, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    }
                }
            });
             evolutionChartInstance.canvas.parentElement.style.height = '300px';
        }

        function updateTable(data) {
            const tableBody = document.getElementById('results-table-body');
            tableBody.innerHTML = ''; // Limpa a tabela anterior
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="py-2 px-4 border-b">${row.year}</td>
                    <td class="py-2 px-4 border-b">${formatCurrency(row.invested)}</td>
                    <td class="py-2 px-4 border-b">${formatCurrency(row.interest)}</td>
                    <td class="py-2 px-4 border-b">${formatCurrency(row.finalBalance)}</td>
                `;
                tableBody.appendChild(tr);
            });
        }
    </script>

</body>
</html>

